# tinygobook_by_rust
[基礎から学ぶ TinyGoの組込み開発 (高砂正哲 著)](https://www.c-r.com/book/detail/1477)のプログラムをRustで書き直してみました。

別言語で書かれた既知の題材のコードを書くことはとても勉強になりました。

# コードの説明

## 5章2節 GPIO
General Purpose I/O (GPIO)の例として、最初にGPIOの例として内蔵LEDを1秒点灯して0.1秒消灯するコードが掲載されています。
次に分かりやすい入力としてボタン入力を扱っています。

### ```p130_led_1```
書籍同様に素直にGPIOのHigh/Lowを切り替えるコードです。
### ```p130_led_2```
内蔵LEDをグローバル変数に変更したコードです。
```main```関数のスコープ外でLEDを制御したい場合に、この方法を取ります。
### ```p130_led_3```
内蔵LEDの構造体を定義して、この構造体をグローバル変数として取り扱うコードです。
LEDの点滅のような簡単なプログラムとしては冗長なコードですが、保守性が必要になるとこの書き方が必要になると思います。

### ```p135_button```
ループ開始時にWio Terminalのいずれかのボタンが入力されていると内蔵LEDを点灯するコードです。
ただし、ボタン入力の判定後には10秒の一時停止処理があるので、入力判定は10秒に一度しか行えません。

書籍のコードでは1秒間隔ですが、割り込み処理の必要性を感じるために停止時間を長くしています。

### ```p137_button_interrupt```
一時停止処理と独立にボタン入力に合わせて内蔵LEDを点灯するコードです。
ボタン入力時に起動する割り込み関数(```#[interrupt]```)を利用することで、いつでも入力できるようになりました。

ただし、入力していない状態の取り出し方が分からないため、それは今後の課題です。

## 5章4節 UART
Universal Asynchronous Receiver/Transmitter (UART)の例として文字列を送受信するコードが掲載されています。
[ハードウエアの段取りは以前作成したリポジトリをご参照ください](https://github.com/Tremendous1192/rust-wio-terminal-exercise/tree/main/ch06_p184_01_uart)。

ただし、UARTの受信方法が分からないため、このリポジトリでは送信のみ扱っています。

### ```p147_uart```
Tera Term にメッセージを送信するコードです。
割と素直に書いたつもりですが、Go言語に比べて長いコードになりました。
### ```p147_uart_static```
UARTドライバをグローバル変数に変更したコードです。
```main```関数のスコープ外でUARTドライバを扱う需要は、内蔵LEDの需要よりもあると思います。

関数内部の```unsafe```スコープでグローバル変数を直接扱うことで、コードは見やすいです。

### ```p147_uart_static_struct```
UARTドライバの構造体を定義して、この構造体をグローバル変数として取り扱うコードです。
コード量は短くなりませんが、安全性を考慮すると構造体を使うのが無難かもしれません。

## 5章5節 ADC
Analog to Digital Converter (ADC)の例として、内蔵光センサーを扱うコードが掲載されています。

### ```p152_light_sensor```
光センサの入力値が50より小さいときに内蔵LEDを点灯するコードです。

こちらもグローバル変数や割り込み処理を書きたかったのですが、**型パズルが難しくて断念しました**。
今後の課題です。

## 5章8節 I2C
Inter-Integrated Circuit (I2C)の例として、内蔵加速度計を扱うコードが掲載されています。

### ```p164_accelerometer```
加速度の大きさが1以上のときに内蔵LEDを点灯するコードです。

### ```p167_accelerometer_uart```
1秒ごとの内蔵加速度センサの値をUARTで送信するコードです。


## 5章13節 その他
この節は残りの機能の紹介です。
Wi-Fiのネットワーク名やパスワードのベタ打ちを防ぐために、SDカードの読み取りだけ取り上げます。

### ```p196_sdcard_list```
SDカードに保存しているファイル名一覧を画面に表示するコードです。

理由は分かりませんが**ファイル名は5文字までしか認識できません**。
さらに大文字になります。

### ```p196_sdcard_read```
指定したテキストファイル内の文字列を表示するコードです。
1度だけ読み込む場合は、このコードの書き方で良いと思います。

### ```p196_sdcard_read_function```
前のプログラムの文字列を読み込む部分を関数にしたコードです。
複数のファイルから読み込む場合、こちらのコードにすべきです。


## 7章3節 network内のアクセスポイントに接続する
### ```p233_wifi_connect```
タイトル通りのコードです。

```no_std```環境でのWebの扱いがよくわからないので、この先は今後の課題です。


